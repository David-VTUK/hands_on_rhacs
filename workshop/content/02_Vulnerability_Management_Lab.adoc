:labname: Vulnerability Management

== {labname} Lab

:numbered:

== Introduction to Vulnerability Management

You start with the topic of vulnerability management because it is familiar for most security teams, even those without prior experience with containers or Kubernetes.

The vulnerability management process helps protect the software supply chain and prevent known vulnerabilities from being used as an entry point into your applications.

In this lab, you explore the vulnerability management features of Red Hat^(R)^ Advanced Cluster Security.

You detect vulnerabilities early in the software lifecycle, and work to resolve them.

.Goals

* Understand reports in the Vulnerability Management Dashboard
* Set and manage risk acceptance workflows (new in Red Hat Advanced Cluster Security [RHACS] 3.73)
* Create a simple report to email to stakeholders (new in RHACS 3.73)

[[labexercises]]
:numbered:

== Review Vulnerability Management Dashboard

More important than fixing any one vulnerability is establishing a process to keep container images updated and to prevent images that have serious, fixable vulnerabilities from being promoted through the pipeline.

=== Explore Vulnerability Management Dashboard Reports

The dashboard provides several important reports--where the vulnerabilities are, which are the most widespread or most recent, where your container images are coming from, and important vulnerabilities in OpenShift^(R)^ itself.

.Procedure
. From the RHACS portal, navigate to *Vulnerability Management -> Dashboard* to see the Vulnerability Management Dashboard:
+
[cols="1a",grid=none,width=80%]
|===
^| image::images/vuln_dashboard.png[link=images/vuln_dashboard.png,window=_blank]
^| Figure 2.1 - Vulnerability Management Dashboard
^| [small]#Click on image to view large size#
|===

+
Buttons along the top of the dashboard link you to the policies, CVEs, nodes, and images.
The *Application & Infrastructure* button displays a list that takes you to reports by cluster, namespace, deployment, and component.
Also note the *Filter CVES* buttons that limit the reports to only *fixable* CVEs or *ALL* CVEs.

[NOTE]
CVE stands for Common Vulnerabilities and Exposures, and is managed by the link:https://www.cve.org/[CVE Program website^].

=== Explore Risky Images Report and Image Details

Images are listed here in order of risk, based on the number and severity of the vulnerabilities present in the components in the images.

.Procedure
. Locate the *Top Riskiest Images* panel and hover over some of the images to get quick pop-up windows with the details.
. Find one of the riskiest images, `mastercard-processor:latest`, and click it.
+
NOTE: If `mastercard-processor:latest` is not in the list of riskiest images, click *View All* and in the *Add one or more filters* box, type `image:` and press *Enter*.
Begin typing the image name, `mastercard-processor:latest`, and let the UI complete the image name for you.
Click the name of the image to select it, then click the name of the image again.

. Review the *Image Overview* page that appears.
+
The vulnerability scanner built into RHACS breaks down images into layers and components--where components can be operating-system installed packages, or dependencies installed by programming languages like Python, Javascript, or Java(TM).
+
The *Image Summary* section provides the important security details of the image overall, with links to the components.
. Just below the *Image Summary* section, click the *Dockerfile* tab to reveal details of the image's Dockerfile.
+
You can also see, at the top, the warning that CVE data is stale.
This image has a base OS version whose distribution has stopped providing security information for it, and is likely to have stopped publishing security fixes for it as well.
+
The *Dockerfile* tab displays the layer-by-layer view, starting from the base image.
This image shows you a serious security problem--the base image was imported more than four years ago and even the most recent layers are more than three years old.
Time is not kind to images and components.
As vulnerabilities are discovered, RHACS displays newly discovered CVEs.
+
. Close the *Dockerfile* tab.

== Accept Risk

At the bottom of the *Overview* tab is the *Image Findings* section.
It focuses on vulnerabilities, sorted by  score and organized into groups of *Observed CVEs*, *Deferred CVEs*, and *False Positive CVEs*.

[NOTE]
The Common Vulnerability Scoring System (CVSS) is an open framework for communicating the characteristics and severity of software vulnerabilities.
Find out more at the link:https://nvd.nist.gov/vuln-metrics/cvss[NIST website^].

The CVE list for each image focuses on the _severe_ violations (CVSS >= 7) and the _fixable_ violations where the upstream package maintainers have published a fix.

In this part of the scenario, you have the role of a developer who is committing to fix a CVE at a later time, or who has investigated the matter and is assuring the security analyst that this is a false positive.
It is not practical to ask your teams to fix Linux^(R)^ or Javascript, but it is reasonable to ask them to pick up fixes published by those communities.
You accept the risk by acknowledging the vulnerability and deferring resolution to a later time.
You communicate this to the security team by creating a deferral and requesting approval.
In later steps you act as the deferral approver and address this.

.Procedure
. Click the *Image Findings* tab.
. Locate a fixable CVE in the list, `CVE-2017-8817`, and click *2 components* to see details.
+
NOTE: This CVE example is very serious--scoring 9.8/10--but fixable.
It is a vulnerability in cURL and libcurl, and these packages are present because they are either part of a base image or were deliberately added by a developer in one of the Dockerfile layers.

. Close the *Affected Components* window.
. Click the options menu icon "image:options_menu_icon.png[]" in the right column and select *Defer CVE* to open the *Mark CVEs for deferral* dialog box.
+
NOTE: This is a new feature in RHACS 3.68.

. Select *2 Weeks* and *Only this image tag*, enter a *Deferral rationale* of your choosing, and click *Request Approval*.
+
The CVE updates with a blue information icon next to the CVE name.

. Click the blue information icon to the right of the CVE and copy the approval link to share with your organization's deferral approver.
. Close the *Vulnerabilities Defer* windows by clicking *X* on the right.

Now move on to look at deployments of this vulnerability.

== Explore Deployed Vulnerabilities

All of this CVE detail is well and good, but it is a bit noisy.
How do you judge the true risk--which vulnerabilities are likely to be exploited?
In other words, which vulnerabilities do you really have to fix first?

RHACS can use other sources of information in OpenShift Container Platform to judge the risk of a given vulnerability being exploited and set priorities for fixes.
The first risk factor you can check is whether the vulnerable component is in a running deployment.

.Procedure
. Scroll back to the top of the *Vulnerability Management Dashboard* and locate the *Top Riskiest Components* panel.
. Click the `curl:7.38.0` component to open a new panel with details about this component.
+
On the right side is the list of *Related Entities*.
Four deployments include this component.

. Click *4 deployments* in the *Related Entities* column on the right to be taken to a list of active deployments that include this vulnerable component.
+
These deployments are running right now with different containers that come from images with this vulnerability present.
+
"Up and running" is a risk factor.
Vulnerabilities are exploited only if they are in a running container somewhere in the cluster.
RHACS displays the critical information here so you can see that this image is present in the production cluster, in namespaces like payments, which starts to provide context to the security team.
The last column on the right displays the risk priority, which RHACS has already determined from configuration and runtime activity in the deployment.
Of these four deployments, the `mastercard-processor` deployment is judged most likely to be exploited.

=== Manage Risk Acceptance

NOTE: This is a new feature in RHACS 3.68

As a security analyst who has the role of deferral approver, you can evaluate requested deferrals and respond to them through the RHACS portal.

.Procedure
. Navigate to *Vulnerability Management -> Risk Acceptance* and search for the CVE.
. Review the vulnerability's comments, scope, and action to decide if you want to approve it.
. Click image:options_menu_icon.png[] at the far right of the CVE and approve or deny the request for approval and provide a rationale.
+
You can see your *Approved Deferrals* from the appropriate tab above and make changes.
. You can also click through to the deployment that has that vulnerability and see its *Risk Priority*:
.. Click `1 deployment`:
+
image::images/rhacs_vuln_deployment.png[RHACS 1 Deployment]
+
.. Click the `mastercard-processor` link to be taken to the *Deployment Overview*.

How is *Risk Priority* determined?
That is the subject of the next lab, "Risk Management."

== Report Vulnerabilities to Teams

NOTE: This is a new feature in RHACS 3.68.

IMPORTANT: You cannot send reports in this training lab. It is not integrated with an email server and there is no email notifier.

As organizations must constantly reassess and report on their vulnerabilities, some find it helpful to have scheduled communications to key stakeholders to help in the vulnerability management process.

You can use RHACS to schedule these recurring communications through email.
Red Hat recommends that you scope these communications to the most relevant information that the key stakeholders need.

For sending these communications, you must consider the following questions:

* What schedule would have the most impact when communicating with stakeholders?
* Who is the audience?
* Should you include only specific severity vulnerabilities in your report?
* Should you include only fixable vulnerabilities in your report?

The following procedure creates a scheduled vulnerability report.

.Procedure
. From the RHACS portal, navigate to *Vulnerability Management -> Reporting*.
. Click *Create report*.
. Enter a name for your report in the *Report name* field: `Deferrals in Payments`.
. Select a weekly or monthly cadence for your report under *Repeat report*: `Weekly`.
. Enter a *Description* for the report: `All deferrals in the Payments namespace`.
. On the next line, there is a series of dropdown boxes to select which vulnerabilities to report.
There are options to report fixable vulnerabilities, vulnerabilities of a specific severity, or only vulnerabilities that have appeared since the last scheduled report.
From the *CVE Severties* drow-down menu, select `Critical` and `Important` severities.
. Under *Configure resource scope*, click *Create resource scope* and create one for the namespace `payments`, and under *Allowed resources* use the switch to under *Manual selection* to select the `production` cluster.
. Click *Save*, which returns you to the *Create a vulnerability report* page.
. Select or create an email notifier to send your report by email and configure your distribution list under *Notification and distribution*.
. Click *Cancel* because this lab environment does not have an available SMTP server to back an email notifier.

== Summary

In this lab, you learned how to interpret the reports in the Vulnerability Management Dashboard.
You went on to set and manage risk acceptance workflows.
Finally, you created a simple report to email to stakeholders.
